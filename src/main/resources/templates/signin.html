<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <title>Title</title>
    <style>
        .allDiv{
            width: 700px;
            margin: auto;
        }
    </style>
</head>
<body>
<div class = "allDiv">
    <h1>회원가입</h1>
    <form id="form" name="formData">
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
            <label for="email">이메일</label>
        </div>
        <div class="form-floating mb-3">
            <input type="password" class="form-control" id="password" placeholder="name@example.com" required>
            <label for="password">비밀번호</label>
        </div>
        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="age" placeholder="name@example.com" required>
            <label for="city">나이</label>
        </div>

        <input type="radio" class="btn-check" id="man" autocomplete="off" value="남자" required>
        <label class="btn btn-outline-secondary" for="man">남자</label>
        <input type="radio" class="btn-check" id="woman" autocomplete="off" value="여자" required>
        <label class="btn btn-outline-secondary" for="woman">여자</label>

        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="city" placeholder="name@example.com" required>
            <label for="city">시</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="county" placeholder="name@example.com" required>
            <label for="county">구/군</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="district" placeholder="name@example.com" required>
            <label for="district">동</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="detail" placeholder="name@example.com" required>
            <label for="detail">상세주소</label>
        </div>

        <div class="d-grid gap-2 col-6 mx-auto">
            <button class="btn btn-primary" type="submit">회원가입</button>
        </div>
    </form>

</div>
</body>
<script>
    function dataSend() {
        if (checkValidation()) {
            let isMan = $('input[id=man]:checked').val();
            let isWoman = $('input[id=woman]:checked').val();
            console.log(isWoman);
            console.log(isMan);
            if (isMan) {
                console.log(isMan);
                sex = "1";
                PostSiginin(sex);
            } else if (isWoman) {
                console.log(isWoman);
                sex = "0";
                PostSiginin(sex);
            } else {
                return;
            }
        }
    }

    function PostSiginin(sex) {
        console.log("회원가입 시도")
        $.ajax({
            type: "post",
            headers: {'Content-Type': 'application/json'},
            url: "/signin",
            data: JSON.stringify({
                email : $("#email").val(),
                password : $("#password").val(),
                sex : sex,
                age : $("#age").val(),
                city : $("#city").val(),
                county : $("#county").val(),
                district : $("#district").val(),
                detailAddress : $("#detail").val()
            }),
            dataType: "json",
            success: function (response) {
                console.log('msg : ' + response.msg);
                console.log('response : ' + response.state);
                alert("회원가입 성공")
            }, error: function () {
                alert("회원가입 실패")
            }
        });
    }

    function checkValidation() {
        let reg_str = /[가-힣a-zA-Z]+$/;
        let reg_num = /[0-9]$/;
        let reg_pw = /[a-z0-9_-]$/;
        let reg_email =/^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;
        if(!reg_email.test($("#email").val())){
            console.log("이메일")
            return false;
        }
        else if (!reg_pw.test($("#password").val())) {
            console.log("비밀번호")
            return false;
        }
        else if (!reg_num.test($("#age").val())) {
            console.log($("#age").val())
            console.log("나이")
            return false;
        }
        else if (!(reg_str.test($("#city").val()) && reg_str.test($("#county").val()) && reg_str.test($("#district").val()) && reg_str.test($("#detail").val()))) {
            console.log("문자 넣으세요")
            return false;
        }
        return true;
    }

    $('#form').submit(function () {
        dataSend();
        return false;
    });
</script>
</html>